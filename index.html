<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>AiBinder Demo</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
            }
            .demo-section {
                margin: 20px 0;
                padding: 20px;
                border: 1px solid #ddd;
                border-radius: 5px;
            }
            .loading {
                color: #666;
                font-style: italic;
            }
            .error {
                color: red;
                font-weight: bold;
            }
            .code-example {
                background: #f8f8f8;
                padding: 10px;
                border-radius: 4px;
                font-family: monospace;
                white-space: pre-wrap;
                margin-top: 10px;
            }
            .note {
                background: #fff3cd;
                color: #856404;
                padding: 10px;
                border-radius: 4px;
                margin: 10px 0;
            }
            .config-toggle {
                display: flex;
                align-items: center;
                gap: 10px;
                cursor: pointer;
                padding: 10px;
                background: #f8f8f8;
                border-radius: 4px;
                margin: 20px 0;
            }
            .config-toggle:hover {
                background: #f0f0f0;
            }
            .config-toggle h2 {
                margin: 0;
                font-size: 1.2em;
            }
            .config-toggle .toggle-icon {
                font-size: 1.2em;
                transition: transform 0.3s ease;
            }
            .config-toggle.expanded .toggle-icon {
                transform: rotate(180deg);
            }
            .config-content {
                display: none;
                margin-top: 15px;
                padding: 15px;
                background: #f8f8f8;
                border-radius: 4px;
            }
            .config-content.active {
                display: block;
            }
            .method-section {
                margin: 10px 0;
                padding: 10px;
                background: #fff;
                border-radius: 4px;
            }
            .method-section h3 {
                margin-top: 0;
            }
            .update-button {
                padding: 8px 16px;
                background-color: #4caf50;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
                transition: background-color 0.3s;
            }
            .update-button:hover {
                background-color: #45a049;
            }
            .update-button:disabled {
                background-color: #cccccc;
                cursor: not-allowed;
            }
            .cooldown-timer {
                margin-left: 10px;
                color: #666;
                font-size: 14px;
            }
            .model-select {
                margin: 10px 0;
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
                width: 100%;
                max-width: 300px;
            }
            .provider-select {
                margin-bottom: 10px;
            }
            .model-select-container {
                margin-bottom: 10px;
            }
            .api-key-container {
                margin-top: 10px;
            }
            .api-key-input {
                margin-right: 10px;
            }
        </style>
    </head>
    <body
        data-ai-binder-prompt="You are a helpful assistant. Always respond in a single sentence. Keep it concise and professional."
        data-ai-binder-model="gemini-2.0-flash"
    >
        <h1>AiBinder Demo</h1>

        <div class="note">
            <strong>Note:</strong> If no API key is provided through attributes
            or configuration, a configuration UI will automatically appear at
            the top of the page.
        </div>

        <div class="config-toggle" onclick="toggleConfig()">
            <span class="toggle-icon">â–¼</span>
            <h2>Configuration Methods</h2>
        </div>

        <div id="config-methods" class="config-content">
            <div class="method-section">
                <h3>Method 1: Body Attributes</h3>
                <p>
                    Set API key, system prompt, and model using data attributes
                    on the body tag:
                </p>
                <div class="code-example">
                    &lt;body data-ai-binder-api-key="your-api-key"
                    data-ai-binder-prompt="Your system prompt here"
                    data-ai-binder-model="gemini-1.0-pro" &gt;
                </div>
            </div>

            <div class="method-section">
                <h3>Method 2: Script Configuration</h3>
                <p>
                    Set API key, system prompt, and model in the script
                    configuration:
                </p>
                <div class="code-example">
                    &lt;script&gt; window.AiBinderConfig = { apiKey:
                    'your-api-key', systemPrompt: 'Your system prompt here',
                    model: 'gemini-1.0-pro' }; &lt;/script&gt;
                </div>
            </div>

            <div class="method-section">
                <h3>Method 3: Runtime Initialization</h3>
                <p>
                    Set API key, system prompt, and model when initializing
                    AiBinder:
                </p>
                <div class="code-example">
                    AiBinder.init('your-api-key', 'Your system prompt here',
                    'gemini-1.0-pro');
                </div>
            </div>

            <div class="method-section">
                <h3>Available Models</h3>
                <div class="provider-select">
                    <label for="providerSelect">Provider:</label>
                    <select
                        id="providerSelect"
                        class="model-select"
                        onchange="updateProvider()"
                    >
                        <option value="gemini">Google Gemini</option>
                        <option value="openai">OpenAI</option>
                        <option value="anthropic">Anthropic</option>
                    </select>
                </div>
                <div class="model-select-container">
                    <label for="modelSelect">Model:</label>
                    <select
                        id="modelSelect"
                        class="model-select"
                        onchange="updateModel()"
                    >
                        <!-- Gemini Models -->
                        <option value="gemini-2.0-flash" data-provider="gemini">
                            Gemini 2.0 Flash
                        </option>
                        <option value="gemini-1.0-pro" data-provider="gemini">
                            Gemini 1.0 Pro
                        </option>
                        <option
                            value="gemini-1.0-pro-vision"
                            data-provider="gemini"
                        >
                            Gemini 1.0 Pro Vision
                        </option>
                        <option value="gemini-1.5-pro" data-provider="gemini">
                            Gemini 1.5 Pro
                        </option>
                        <option
                            value="gemini-1.5-pro-vision"
                            data-provider="gemini"
                        >
                            Gemini 1.5 Pro Vision
                        </option>
                        <!-- OpenAI Models -->
                        <option value="gpt-4" data-provider="openai">
                            GPT-4
                        </option>
                        <option value="gpt-4-turbo" data-provider="openai">
                            GPT-4 Turbo
                        </option>
                        <option
                            value="gpt-4-vision-preview"
                            data-provider="openai"
                        >
                            GPT-4 Vision
                        </option>
                        <option value="gpt-3.5-turbo" data-provider="openai">
                            GPT-3.5 Turbo
                        </option>
                        <option
                            value="gpt-3.5-turbo-instruct"
                            data-provider="openai"
                        >
                            GPT-3.5 Turbo Instruct
                        </option>
                        <!-- Anthropic Models -->
                        <option value="claude-3-opus" data-provider="anthropic">
                            Claude 3 Opus
                        </option>
                        <option
                            value="claude-3-sonnet"
                            data-provider="anthropic"
                        >
                            Claude 3 Sonnet
                        </option>
                        <option
                            value="claude-3-haiku"
                            data-provider="anthropic"
                        >
                            Claude 3 Haiku
                        </option>
                        <option value="claude-2.1" data-provider="anthropic">
                            Claude 2.1
                        </option>
                        <option value="claude-2.0" data-provider="anthropic">
                            Claude 2.0
                        </option>
                        <option
                            value="claude-instant-1.2"
                            data-provider="anthropic"
                        >
                            Claude Instant 1.2
                        </option>
                    </select>
                </div>
                <div class="api-key-container">
                    <label for="apiKeyInput">API Key:</label>
                    <input
                        type="password"
                        id="apiKeyInput"
                        class="api-key-input"
                        placeholder="Enter API key for selected provider"
                    />
                    <button onclick="updateApiKey()" class="update-button">
                        Update API Key
                    </button>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>Basic Usage</h2>
            <p
                data-prompt="Generate a welcome message for {name} who is a {role}."
                class="loading"
            >
                Loading...
            </p>
        </div>

        <div class="demo-section">
            <h2>Multiple Placeholders</h2>
            <p
                data-prompt="Create a description for {product} that costs ${price} and is available in {color}."
                class="loading"
            >
                Loading...
            </p>
        </div>

        <div class="demo-section">
            <h2>Dynamic Update</h2>
            <p
                data-prompt="Current time is {time} and the weather is {weather}."
                class="loading"
            >
                Loading...
            </p>
            <button
                id="updateButton"
                class="update-button"
                onclick="updateDynamicContent()"
            >
                Update Content
            </button>
            <span id="cooldownTimer" class="cooldown-timer"></span>
        </div>

        <script src="dist/ai-binder.min.js"></script>
        <script>
            // Configuration
            window.AiBinderConfig = {
                apiKey: "AIzaSyC2AjoVFamGYltppQJU_0iBoPV42-kUL_w",
                systemPrompt:
                    "You are a helpful assistant. Always respond in a single sentence. Keep it concise and professional.",
                model: "gemini-2.0-flash",
                provider: "gemini",
            };

            // Initial context
            const initialContext = {
                name: "John",
                role: "developer",
                product: "Smartphone",
                price: "999",
                color: "black",
                time: new Date().toLocaleTimeString(),
                weather: "sunny",
            };

            // Initialize AiBinder
            let binder = AiBinder.init();

            // Cooldown period in seconds
            const COOLDOWN_PERIOD = 60;
            let isGenerating = false;
            let cooldownInterval;

            // Process all prompts
            function processAllPrompts(context) {
                try {
                    const promptElements =
                        document.querySelectorAll("[data-prompt]");

                    promptElements.forEach((element) => {
                        element.textContent = "Loading...";
                        element.classList.add("loading");
                        element.classList.remove("error");

                        try {
                            const newBinder = AiBinder.init();
                            newBinder.bind(context).process(element);
                        } catch (error) {
                            console.error("Error processing prompt:", error);
                            element.textContent = "Error: " + error.message;
                            element.classList.remove("loading");
                            element.classList.add("error");
                        }
                    });
                } catch (error) {
                    console.error("Error in processAllPrompts:", error);
                } finally {
                    startCooldown();
                }
            }

            // Function to start cooldown period
            function startCooldown() {
                isGenerating = false;
                const button = document.getElementById("updateButton");
                const timer = document.getElementById("cooldownTimer");
                let timeLeft = COOLDOWN_PERIOD;

                button.disabled = true;
                timer.textContent = `(Cooldown: ${timeLeft}s)`;

                cooldownInterval = setInterval(() => {
                    timeLeft--;
                    timer.textContent = `(Cooldown: ${timeLeft}s)`;

                    if (timeLeft <= 0) {
                        clearInterval(cooldownInterval);
                        button.disabled = false;
                        timer.textContent = "";
                    }
                }, 1000);
            }

            // Initial processing
            processAllPrompts(initialContext);

            // Function to update dynamic content
            function updateDynamicContent() {
                if (isGenerating) return;

                try {
                    isGenerating = true;
                    const button = document.getElementById("updateButton");
                    button.disabled = true;

                    const newContext = {
                        ...initialContext,
                        time: new Date().toLocaleTimeString(),
                        weather: Math.random() > 0.5 ? "sunny" : "rainy",
                    };
                    processAllPrompts(newContext);
                } catch (error) {
                    console.error("Error in updateDynamicContent:", error);
                    isGenerating = false;
                    document.getElementById("updateButton").disabled = false;
                }
            }

            // Function to toggle configuration methods
            function toggleConfig() {
                const toggle = document.querySelector(".config-toggle");
                const content = document.getElementById("config-methods");

                toggle.classList.toggle("expanded");
                content.classList.toggle("active");
            }

            // Function to update API key
            function updateApiKey() {
                const apiKeyInput = document.getElementById("apiKeyInput");
                const newApiKey = apiKeyInput.value.trim();

                if (newApiKey) {
                    // Update the configuration
                    window.AiBinderConfig.apiKey = newApiKey;

                    // Update the body attribute
                    document.body.setAttribute(
                        "data-ai-binder-api-key",
                        newApiKey,
                    );

                    // Reinitialize AiBinder with the new API key
                    binder = AiBinder.init();

                    // Reprocess all prompts with the new configuration
                    processAllPrompts(initialContext);

                    // Clear the input field
                    apiKeyInput.value = "";

                    console.log("API key updated:", newApiKey);
                }
            }

            // Function to update provider
            function updateProvider() {
                const providerSelect =
                    document.getElementById("providerSelect");
                const modelSelect = document.getElementById("modelSelect");
                const apiKeyInput = document.getElementById("apiKeyInput");
                const selectedProvider = providerSelect.value;

                // Update the provider in the configuration
                window.AiBinderConfig.provider = selectedProvider;

                // Update the body attribute
                document.body.setAttribute(
                    "data-ai-binder-provider",
                    selectedProvider,
                );

                // Filter and show only models for the selected provider
                const modelOptions = modelSelect.querySelectorAll("option");
                modelOptions.forEach((option) => {
                    option.style.display =
                        option.dataset.provider === selectedProvider
                            ? ""
                            : "none";
                });

                // Select the first available model for the provider
                const firstModel = modelSelect.querySelector(
                    `option[data-provider="${selectedProvider}"]`,
                );
                if (firstModel) {
                    modelSelect.value = firstModel.value;
                    updateModel();
                }

                // Update API key input placeholder based on provider
                apiKeyInput.placeholder = `Enter ${
                    selectedProvider.charAt(0).toUpperCase() +
                    selectedProvider.slice(1)
                } API key`;

                console.log("Provider updated:", selectedProvider);
            }

            // Function to update model
            function updateModel() {
                const modelSelect = document.getElementById("modelSelect");
                const selectedModel = modelSelect.value;

                // Update the model in the configuration
                window.AiBinderConfig.model = selectedModel;

                // Update the body attribute
                document.body.setAttribute(
                    "data-ai-binder-model",
                    selectedModel,
                );

                // Reinitialize AiBinder with the new model
                binder = AiBinder.init();

                // Reprocess all prompts with the new model
                processAllPrompts(initialContext);

                console.log("Model updated:", selectedModel);
            }

            // Initialize provider selection
            updateProvider();
        </script>
    </body>
</html>
